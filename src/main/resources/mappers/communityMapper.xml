<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.spring.javaProjectS4.dao.CommunityDAO">
	<select id="getMemberMid" resultType="com.spring.javaProjectS4.vo.MemberVO">
		select * from memberS where mid = #{mid};
	</select>
	<select id="getCommunityRecCnt" resultType="int">
		select count(*) from communityS where userDel = 'N';
	</select>
	<select id="getCommunityList" resultType="com.spring.javaProjectS4.vo.CommunityVO">
		select *,(select profile from memberS mem where comu.mid = mem.mid ) as profile,
		(select nickName from memberS mem where comu.mid = mem.mid ) as nickName,
		(select count(*) from goodS gds where gds.part = 'community' and gds.partIdx = comu.idx and gds.goodMid = #{sMid} ) as midGoodCheck,
		(select count(*) from goods gds where gds.part = 'community' and gds.partIdx = comu.idx) as goodCnt,
		(select count(*) from replyS rps where rps.part = 'community' and rps.partIdx = comu.idx ) as replyCnt,
		(select count(*) from bookmarkS bms where bms.part = 'community' and bms.partIdx = comu.idx and bms.bookmarkMid = #{sMid} ) as midBookmarkCheck,
		(select count(*) from bookmarkS bms where bms.part = 'community' and bms.partIdx = comu.idx ) as bookmarkCnt
		from communityS comu where userDel = 'N' order by idx desc limit #{startIndexNo},#{pageSize};
	</select>
	<select id="getCommunityIdx" resultType="com.spring.javaProjectS4.vo.CommunityVO">
		select * from communityS where idx = #{idx};
	</select>
	
	<insert id="setCommunityInput">
		insert into communityS values (default,#{mid},#{content},#{imgsStr},default,#{region},default);
	</insert>
	<insert id="setGoodYes">
		insert into goodS values (default,#{part},#{idx},#{mid},default,default)
	</insert>
	<insert id="setBookmarkYes">
		insert into bookmarkS values (default,#{part},#{idx},#{mid},default);
	</insert>
	<insert id="setReplyInput">
		insert into replyS values (default,#{part},#{idx},#{mid},#{content},default,default,default);
	</insert>
	
	<delete id="setGoodNo">
		delete from goodS where goodMid = #{mid} and part = #{part} and partIdx = #{idx};
	</delete>
	<delete id="setBookmarkNo">
		delete from bookmarkS where bookmarkMid = #{mid} and part = #{part} and partIdx = #{idx};
	</delete>
	<delete id="setCommunityDel">
		delete from communityS where idx = #{idx};
	</delete>
	<delete id="setCommunityReplyAllDel">
		delete from replyS where part = #{part} and partIdx = #{idx};
	</delete>
	<delete id="setCommunityGoodAllDel">
		delete from goodS where part = #{part} and partIdx = #{idx};
	</delete>
	<delete id="setCommunityBookmarkDel">
		delete from bookmarkS where part = #{part} and partIdx = #{idx};
	</delete>
</mapper>