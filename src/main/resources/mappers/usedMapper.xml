<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.spring.javaProjectS4.dao.UsedDAO">
	<select id="getTopCategoryList" resultType="com.spring.javaProjectS4.vo.TopCategoryVO">
		select * from topCategoryS order by idx;
	</select>
	<select id="getMidCategoryList" resultType="com.spring.javaProjectS4.vo.MidCategoryVO">
		select * from midCategoryS order by idx;
	</select>
	<select id="getBtmCategoryList" resultType="com.spring.javaProjectS4.vo.BtmCategoryVO">
		select * from btmCategoryS order by idx;
	</select>
	<select id="getMemberMid" resultType="com.spring.javaProjectS4.vo.MemberVO">
		select * from memberS where mid = #{mid};
	</select>
	<select id="getUsedAllList" resultType="com.spring.javaProjectS4.vo.UsedVO">
		select *,timestampdiff(second,uploadDate,now()) as second_diff,timestampdiff(minute,uploadDate,now()) as minute_diff,
			timestampdiff(hour,uploadDate,now()) as hour_diff, timestampdiff(day,uploadDate,now()) as day_diff, 
			timestampdiff(month,uploadDate,now()) as month_diff, timestampdiff(year,uploadDate,now()) as year_diff
			from usedS where userDel = 'N' order by uploadDate desc limit #{startIndexNo},#{pageSize};
	</select>
	<select id="getUsedAllRecCnt" resultType="int">
		select count(*) from usedS where userDel = 'N';
	</select>
	<select id="getUsedIdx" resultType="com.spring.javaProjectS4.vo.UsedVO">
		select * from usedS where idx = #{idx};
	</select>
	<select id="getUsedMidRecCnt" resultType="int">
		select count(*) from usedS where mid = #{searchString};
	</select>
	<select id="getSaleUsedMidRecCnt" resultType="int">
		select count(*) from usedS where mid = #{searchString} and state = '판매중';
	</select>
	<select id="getUsedMidList" resultType="com.spring.javaProjectS4.vo.UsedVO">
		select * from usedS where mid = #{mid} limit #{startIndexNo},#{pageSize};
	</select>
	<select id="getSaleUsedMidList" resultType="com.spring.javaProjectS4.vo.UsedVO">
		select * from usedS where mid = #{mid} and state = '판매중' limit #{startIndexNo},#{pageSize};
	</select>
	<select id="getFollowerList" resultType="com.spring.javaProjectS4.vo.FollowVO" >
		select * from followS where followingMid = #{mid};
	</select>
	<select id="getFollowingList" resultType="com.spring.javaProjectS4.vo.FollowVO" >
		select * from followS where followerMid = #{mid};
	</select>
	<select id="getFollowerMid" resultType="com.spring.javaProjectS4.vo.FollowVO">
		select * from followS where followerMid = #{mid};
	</select>
	<select id="getStoreMid" resultType="com.spring.javaProjectS4.vo.StoreVO">
		select * from storeS where mid = #{mid};
	</select>
	<select id="getLikeMid" resultType="com.spring.javaProjectS4.vo.LikeVO">
		select * from likeS where likeMid = #{mid};
	</select>
	<select id="getFollowingCheckMid" resultType="com.spring.javaProjectS4.vo.FollowVO">
		select * from followS where followingMid = #{mid};
	</select>
	<select id="getNowUploadUsed" resultType="com.spring.javaProjectS4.vo.UsedVO">
		select * from usedS where mid = #{mid} order by idx desc limit 1;
	</select>
	
	<insert id="setUsedInput">
		insert into usedS values (default,#{imgsStr},#{title},#{topCategoryIdx},#{midCategoryIdx},#{btmCategoryIdx},#{region},#{usedState},#{exchange},#{money},#{delivery},#{content},#{mid},default,default,default,default,default);
	</insert>
	<insert id="setFollowInput">
		insert into followS values (default,#{followerMid},#{followingMid},default,default);
	</insert>
	<insert id="setFollowUsedAlarmInput">
		insert into followUsedAlarmS values (default,#{idx},#{mid},#{followerMid});
	</insert>
	
	<delete id="setFollowDelete">
		delete from followS where followerMid = #{followerMid} and followingMid = #{followingMid};
	</delete>
	
	<update id="setViewCntUpdate">
		update usedS set viewCnt = viewCnt + 1 where idx = #{idx};
	</update>
</mapper>